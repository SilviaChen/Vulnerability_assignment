import os
import json
from flask import jsonify, request, Response

file_path = './data/users.json'


def get_json_data():
    print(os.path.dirname(os.path.abspath(__file__)))
    file = open(file_path, "r")
    data = json.loads(file.read())
    file.close()
    return data


def get_users_in_file(uuid=None):
    data = get_json_data()

    if uuid:
        for i in data:
            if i['id'] == int(uuid):
                return i
    return data


def get_users_info():
    return_value = jsonify({'users': get_users_in_file()})
    return return_value


def add_user_in_file(user_info):
    data = get_json_data()
    data.append(user_info)
    file = open(file_path, "w")
    json.dump(data, file)
    return data


def update_email_in_file(uuid, email):
    data = get_json_data()
    for i in data:
        if i['id'] == int(uuid):
            i['email'] = email

    file = open(file_path, "w")
    json.dump(data, file)
    return data


def add_user():
    request_data = request.get_json()
    add_user_in_file(request_data)
    response = Response(json.dumps(request_data), 201, mimetype="application/json")
    response.headers['Location'] = "users/" + str(request_data['username'])
    return response


def get_by_id(uuid):
    return_value = get_users_in_file(uuid=uuid)
    return return_value


def update_email(uuid):
    request_data = request.get_json()
    response = update_email_in_file(uuid, request_data['email'])
    return response
